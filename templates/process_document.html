{% extends 'base.html' %}

{% block title %}处理办件{% endblock %}

{% block content %}
    <div class="container mt-4">
        <h2 class="text-primary">处理办件</h2>
        <div class="card bg-light">
            <div class="card-body">
                <p class="card-text"><span class="fw-bold">办件名:</span> {{ document.title }}</p >
                <p class="card-text"><span class="fw-bold">办件备注:</span> {{ document.content }}</p >
                <p class="card-text"><span class="fw-bold">收件人:</span> {{ document.creator }}</p >
                <p class="card-text"><span class="fw-bold">承接部门:</span>{{ document.department }}</p >
                <p class="card-text"><span class="fw-bold">截至日期:</span> {{ document.due_date }}</p >
                {% if document.department == user.employee.department %}
                    <form id="myForm" method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="status" class="form-label">状态:</label>
                            <select name="status" id="status" class="form-select">
                                <option value="未接收" class="text-primary">未接收</option>
                                <option value="处理中" class="text-warning">处理中</option>
                                <option value="已完成" class="text-success">已完成</option>
                            </select>
                        </div>
                        <button id="submitButton" type="submit" class="btn btn-primary">确认执行操作</button>
                    </form>
                {% else %}
                    <p class="card-text"><span class="fw-bold">非承接部门，不可修改办件状态</span></p >
                {% endif %}
            </div>
        </div>
    </div>
    <script>
        document.getElementById('myForm').addEventListener('submit', function (event) {
            // 阻止表单的默认提交行为
            event.preventDefault();

            // 弹出确认对话框
            Swal.fire({
                title: '确认操作',
                text: '您确定要执行此操作吗？',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '确认',
                cancelButtonText: '取消'
            }).then((result) => {
                if (result.isConfirmed) {
                    // 用户点击了确认按钮，提交表单
                    document.getElementById('myForm').submit();
                }
            });
        });
    </script>
{% endblock %}