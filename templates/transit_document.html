{% extends 'base.html' %}

{% block title %}办件流转{% endblock %}

{% block content %}
    <div class="container mt-4">
        <h2 class="text-primary">办件流转</h2>
        <div class="card bg-light">
            <div class="card-body">
                <p class="card-text"><span class="fw-bold">办件名:</span> {{ document.title }}</p >
                <p class="card-text"><span class="fw-bold">办件备注:</span> {{ document.content }}</p >
                <p class="card-text"><span class="fw-bold">收件人:</span> {{ document.creator }}</p >
                <p class="card-text"><span class="fw-bold">承接部门:</span> {{ document.department }}</p >
                <p class="card-text"><span class="fw-bold">截至日期:</span> {{ document.due_date }}</p >
                {% if document.department == user.employee.department %}
                    <form method="post" id="myForm">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="next_department" class="form-label">下一个承接部门:</label>
                            <select name="next_department" id="next_department" class="form-select">
                                {% for department in next_departments %}
                                    <option value="{{ department.id }}">{{ department.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button id="submitButton" type="submit" class="btn btn-primary">
                            流转
                        </button>
                    </form>
                {% else %}
                    <p class="card-text"><span class="fw-bold">非承接部门，无法进行流转操作</span></p >
                {% endif %}
            </div>
        </div>
    </div>
    <script>
        document.getElementById('myForm').addEventListener('submit', function (event) {
            // 阻止表单的默认提交行为
            event.preventDefault();

            // 弹出确认对话框
            Swal.fire({
                title: '确认操作',
                text: '确定要流转下一个部门吗？',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '确认',
                cancelButtonText: '取消'
            }).then((result) => {
                if (result.isConfirmed) {
                    // 用户点击了确认按钮，提交表单
                    document.getElementById('myForm').submit();
                }
            });
        });
    </script>
{% endblock %}